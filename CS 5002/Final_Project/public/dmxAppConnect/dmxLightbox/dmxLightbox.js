/*!
 DMXzone Lightbox
 Version: 1.1.0
 (c) 2023 Wappler.io
 @build 2023-01-19 09:39:52
 */
!function(e){"use strict";var t,n,o={w3:{enabled:"fullscreenEnabled",element:"fullscreenElement",request:"requestFullscreen",exit:"exitFullscreen",events:{change:"fullscreenchange",error:"fullscreenerror"}},webkit:{enabled:"webkitFullscreenEnabled",element:"webkitCurrentFullScreenElement",request:"webkitRequestFullscreen",exit:"webkitExitFullscreen",events:{change:"webkitfullscreenchange",error:"webkitfullscreenerror"}},moz:{enabled:"mozFullScreenEnabled",element:"mozFullScreenElement",request:"mozRequestFullScreen",exit:"mozCancelFullScreen",events:{change:"mozfullscreenchange",error:"mozfullscreenerror"}},ms:{enabled:"msFullscreenEnabled",element:"msFullscreenElement",request:"msRequestFullscreen",exit:"msExitFullscreen",events:{change:"MSFullscreenChange",error:"MSFullscreenError"}}},i=o.w3;for(n in o)if(o[n].enabled in e){t=o[n];break}function r(t,n){var o=e.createEvent("Event");o.initEvent(t,!0,!1),n.dispatchEvent(o)}function l(n){return function(o,r){n!==i.exit||e[t.element]?(e.addEventListener(t.events.change,(function n(){o(),e.removeEventListener(t.events.change,n,!1)}),!1),e.addEventListener(t.events.error,(function n(){r(new TypeError),e.removeEventListener(t.events.error,n,!1)}),!1)):setTimeout((function(){r(new TypeError)}),1)}}!(i.enabled in e)&&t&&(e.addEventListener(t.events.change,(function(n){n.stopPropagation(),n.stopImmediatePropagation(),e[i.enabled]=e[t.enabled],e[i.element]=e[t.element],r(i.events.change,n.target)}),!1),e.addEventListener(t.events.error,(function(e){r(i.events.error,e.target)}),!1),e[i.enabled]=e[t.enabled],e[i.element]=e[t.element],e[i.exit]=function(){var n=e[t.exit]();return!n&&window.Promise?new Promise(l(i.exit)):n},Element.prototype[i.request]=function(){var e=this[t.request].apply(this,arguments);return!e&&window.Promise?new Promise(l(i.request)):e})}(document),function(){"use strict";var e,t,n,o,i,r,l,s;dmx.lightbox={count:0,gallery:{},options:{fullscreen:!1,noscrollbars:!1,autoplay:!1,loopvideo:!1,buttons:"auto",animation:"slide",spinner:"Spinner1"}};var a="dmxLightbox",d={count:0};function u(){if(c()){for(var t=e.getElementsByTagName("video"),n=0;n<t.length;n++)t[n].paused||t[n].pause();dmx.lightbox.options.noscrollbars&&(document.documentElement.style.removeProperty("overflow"),document.body.style.removeProperty("overflow")),document.removeEventListener("keydown",E),e.classList.remove("dmxLightboxVisible"),setTimeout((function(){e.style.removeProperty("display"),document.fullscreenElement&&document.exitFullscreen(),dmx.lightbox.component&&dmx.lightbox.component.dispatchEvent("hide")}),500),r.focus()}}function c(){return"block"===e.style.display}function m(){s>=1?(s--,b(),h(s)):"none"!==dmx.lightbox.options.animation&&(t.classList.add("dmxLightboxBounceLeft"),setTimeout((function(){t.classList.remove("dmxLightboxBounceLeft")}),400))}function p(){s<=l.images.length-2?(s++,b(),g(s)):"none"!==dmx.lightbox.options.animation&&(t.classList.add("dmxLightboxBounceRight"),setTimeout((function(){t.classList.remove("dmxLightboxBounceRight")}),400))}function h(e){f(e-1,(function(){h(e-1)}))}function g(e){f(e+1,(function(){g(e+1)}))}function x(){"hide"!==dmx.lightbox.options.buttons?n.focus():i.focus()}function f(t,n){var o=l.images[t],i=l.nodes[t];if(o&&i){var r=o.getElementsByTagName("figure")[0];if(r&&r.getAttribute("url")==i.href){if(n&&n(),dmx.lightbox.options.autoplay)for(var a=e.getElementsByTagName("video"),d=0;d<a.length;d++)a[d]==o.querySelector("video")?a[d].play():a[d].paused||a[d].pause()}else{r&&r.parentNode.removeChild(r);var u=B("figure",{id:"dmxLightboxFigure"+t,url:i.href}),c=B("div",{class:S("Spinner",dmx.lightbox.options.spinner)});u.appendChild(c),i.title&&u.appendChild(B("figcaption",{id:"dmxLightboxCaption"+t},i.title));var m="image";if(i.hasAttribute("data-type"))m=i.getAttribute("data-type");else{var p=i.href;window.URL&&(p=new URL(i.href).pathname),/\.(avi|mp4|mov|og[mvg]|webm)$/i.test(p)&&(m="video")}if("image"==m){var h=B("img");h.onload=function(){u.removeChild(c),n&&n()},h.setAttribute("src",i.href),u.appendChild(h)}else if("video"==m){var g=B("video");g.controls=!0,g.loop=dmx.lightbox.options.loopvideo;var x=B("source",{src:i.href});g.addEventListener("canplay",(function e(){g.removeEventListener("canplay",e),u.removeChild(c),n&&n(),dmx.lightbox.options.autoplay&&s===t&&g.play()})),g.appendChild(x),u.appendChild(g)}else u.appendChild(B("div",{},'<a href="'+i.href+'">Url not supported</a>')),u.removeChild(c),n&&n();o.appendChild(u)}}}function b(){var e="translate3d("+100*-s+"%,0,0)";"fade"===dmx.lightbox.options.animation?(t.style.setProperty("opacity",0),setTimeout((function(){t.style.setProperty("transform",e),t.style.setProperty("opacity",1)}),400)):t.style.setProperty("transform",e)}function v(t){c()&&!e.contains(t.target)&&(t.stopPropagation(),x())}function y(e){document.fullscreenElement||u()}function E(e){switch(e.keyCode){case 37:m();break;case 39:p();break;case 27:u()}}function L(e){-1!==e.target.id.indexOf("dmxLightboxImage")&&u()}function w(e){e.stopPropagation(),m()}function C(e){e.stopPropagation(),p()}function P(e){e.stopPropagation(),u()}function k(e){d.count++,d.startX=e.changedTouches[0].pageX,d.startY=e.changedTouches[0].pageY}function F(e){d.count--,d.done=!1}function T(e){if(!(d.done||d.count>1)){e.preventDefault();var t=e.changedTouches[0].pageX,n=e.changedTouches[0].pageY;t-d.startX>40?(d.done=!0,m()):d.startX-t>40?(d.done=!0,p()):d.startY-n>100&&u()}}function B(e,t,n){var o=document.createElement(e);return t&&Object.keys(t).forEach((function(e){o.setAttribute(e,t[e])})),n&&(o.innerHTML=n),o}function S(){return a+[].join.call(arguments," dmxLightbox")}dmx.lightbox.register=function(e){if(dmx.lightbox.component)return console.warn("Only 1 lightbox component should be used on the page!");dmx.lightbox.component=e},dmx.lightbox.getGallery=function(e){return dmx.lightbox.gallery[e]||(dmx.lightbox.gallery[e]={nodes:[],images:[]}),dmx.lightbox.gallery[e]},dmx.lightbox.addToGallery=function(e,t){var n=dmx.lightbox.getGallery(e);-1===n.nodes.indexOf(t)&&(n.nodes.push(t),n.updated=!0)},dmx.lightbox.setOptions=function(e){dmx.lightbox.options=dmx.extend(dmx.lightbox.options,e)},dmx.lightbox.run=function(a,d){var u=dmx.lightbox.gallery[a];if(!u)return alert("Gallery "+a+" does not exist.");e||(e=B("div",{class:S("Overlay"),role:"dialog"}),t=B("div",{class:S("Slider")}),n=B("button",{class:S("Button","Prev"),type:"button","aria-label":"Previous"}),o=B("button",{class:S("Button","Next"),type:"button","aria-label":"Next"}),i=B("button",{class:S("Button","Close"),type:"button","aria-label":"Close"}),e.appendChild(t),e.appendChild(n),e.appendChild(o),e.appendChild(i),document.body.appendChild(e),document.addEventListener("focus",v,!0),document.addEventListener("fullscreenchange",y),e.addEventListener("click",L),n.addEventListener("click",w),o.addEventListener("click",C),i.addEventListener("click",P),e.addEventListener("touchstart",k),e.addEventListener("touchend",F),e.addEventListener("touchmove",T)),function(i){l=i,function(){var e=dmx.extend(dmx.lightbox.options);t.style.transition="fade"===e.animation?"opacity .4s ease":"slide"===e.animation?"":"none","auto"!==e.buttons||!("ontouchstart"in window)&&1!==l.nodes.length||(e.buttons="hide");n.style.display=o.style.display="hide"===e.buttons?"none":""}();for(;t.firstChild;)t.removeChild(t.firstChild);i.nodes=i.nodes.filter((function(e){var t=document.body.contains(e);return t||(i.updated=!0),t})),i.updated&&(i.images=[],i.updated=!1);for(var r=[],s=[],a=0;a<i.nodes.length;a++)i.images[a]||i.images.push(B("div",{id:"dmxLightboxImage"+a,class:"dmxLightboxImage"})),r.push("dmxLightboxFigure"+a),s.push("dmxLightboxCaption"+a),t.appendChild(i.images[a]);e.setAttribute("aria-labelledby",r.join(" ")),e.setAttribute("aria-describedby",s.join(" "))}(u),function(t){dmx.lightbox.options.noscrollbars&&(document.documentElement.style.setProperty("overflow","hidden"),document.body.style.setProperty("overflow","scroll"));if(c())return;document.addEventListener("keydown",E),s=t,f(t,(function(){g(t),h(t)})),b(),e.style.setProperty("display","block"),dmx.lightbox.options.fullscreen&&e.requestFullscreen&&e.requestFullscreen();setTimeout((function(){e.classList.add("dmxLightboxVisible"),dmx.lightbox.component&&dmx.lightbox.component.dispatchEvent("show")}),50),r=document.activeElement,x()}(u.nodes.indexOf(d))}}(),dmx.Component("lightbox",{attributes:{fullscreen:{type:Boolean,default:!1},noscrollbars:{type:Boolean,default:!1},autoplay:{type:Boolean,default:!1},loopvideo:{type:Boolean,default:!1},buttons:{type:String,default:"auto"},animation:{type:String,default:"slide"},spinner:{type:String,default:"Spinner1"}},events:{show:Event,hide:Event},render:function(e){dmx.lightbox.register(this),dmx.BaseComponent.prototype.render.call(this,e)},update:function(e){dmx.lightbox.setOptions(this.props)}}),dmx.Attribute("lightbox","mounted",(function(e,t){var n=t.argument||"dmxImage"+ ++dmx.lightbox.count;dmx.lightbox.addToGallery(n,e),e.addEventListener("click",(function(t){t.preventDefault(),dmx.lightbox.run(n,e)}))}));
//# sourceMappingURL=../maps/dmxLightbox.js.map
